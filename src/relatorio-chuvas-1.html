<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Planilhas de Precipitação - CGE</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/yui/3.4.1/cssreset/reset-min.css"
      type="text/css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/yui/3.4.1/cssfonts/fonts-min.css"
      type="text/css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/yui/3.4.1/cssgrids/cssgrids-min.css"
      type="text/css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/yui/3.4.1/cssbase/base-min.css"
      type="text/css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/global.css" type="text/css" />
    <link rel="icon" type="image/png" href="favicon/favicon-16x16.png" />
    <link rel="stylesheet" href="https://use.typekit.net/rzd2bbz.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/yui/3.4.1/yui/yui-min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
    <script src="js/nav-bar.js"></script>
    <style>
      body {
        background: url(images/lay/NB_dia_bg.png) repeat-x top;
      }
      .condTempo {
        background: url(images/lay/NB_dia.png) no-repeat top;
      }
    </style>
  </head>
  <body>
    <div id="doc">
      <div id="hd">
        <div id="topo-cidade-sp" class="condTempo">
          <div id="topo-prefeitura-sp">
            <a href="http://www.capital.sp.gov.br/" target="_blank"><div id="logo-prefeitura-sp"></div></a>
          </div>
          <a href="/"><div id="logo_cge"></div></a>
        </div>

        <div class="yui-skin-nav-bar" id="wrap-nav-bar">
          <div id="nav-bar" class="yui3-menu yui3-menu-horizontal yui3-menubuttonnav yui3-loading">
            <div class="yui3-menu-content">
              <ul class="first-of-type topicos">
                <li class="yui3-menuitem topico"><a class="yui3-menuitem-content" href="index.jsp">Home</a></li>
                <li class="yui3-menuitem topico"><a class="yui3-menuitem-content" href="noticias.jsp">Notícias</a></li>
                <li class="topico">
                  <span class="yui3-menu-label">
                    <a href="#"></a>
                    <a href="#tempo-options" class="yui3-menu-toggle">Tempo</a>
                  </span>
                  <div class="yui3-menu" id="tempo-options">
                    <div class="yui3-menu-content">
                      <ul class="first-of-type">
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="estacoes-meteorologicas.jsp">Estações Meteorológicas</a>
                        </li>
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="/cgesp/satellite.jpg" target="_blank">Imagem de Satélite</a>
                        </li>
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="previsao_estendida.jsp">Previsão Estendida</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </li>

                <li class="yui3-menuitem topico">
                  <span class="yui3-menu-label">
                    <a href="#"></a>
                    <a href="#alagamentos-options" class="yui3-menu-toggle">Alagamentos</a>
                  </span>
                  <div class="yui3-menu" id="alagamentos-options">
                    <div class="yui3-menu-content">
                      <ul>
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="alagamentos.jsp">Ver alagamentos</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </li>

                <li class="yui3-menuitem topico">
                  <span class="yui3-menu-label">
                    <a href="#"></a>
                    <a href="#o-cge-options" class="yui3-menu-toggle">Quem Somos</a>
                  </span>
                  <div class="yui3-menu" id="o-cge-options">
                    <div class="yui3-menu-content">
                      <ul class="first-of-type">
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="quem-somos.jsp">Quem Somos</a>
                        </li>
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="monitoramento.jsp">Monitoramento</a>
                        </li>
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="operacao-chuvas-de-verao.jsp">Operação Verão</a>
                        </li>
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="umidade-relativa-do-ar.jsp">Umidade do Ar</a>
                        </li>
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="baixas-temperaturas.jsp">Baixas Temperaturas</a>
                        </li>
                        <li class="yui3-menuitem">
                          <a class="yui3-menuitem-content" href="fontes-de-informacao.jsp">Fontes de Informação</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </li>
                <li class="yui3-menuitem topico">
                  <a class="yui3-menuitem-content" href="dicas.jsp">Dicas</a>
                </li>
                <li class="yui3-menuitem topico">
                  <a class="yui3-menuitem-content" href="sala-de-imprensa.jsp">Sala de Imprensa</a>
                </li>
                <li class="yui3-menuitem topico">
                  <a class="yui3-menuitem-content" href="contato.jsp">Contato</a>
                </li>
                <li class="yui3-menuitem topico">
                  <a class="yui3-menuitem-content" href="https://www.facebook.com/CGESAOPAULO/" target="_blank">
                    <i class="fab fa-facebook-square" style="font-size: 21px; color: white"></i>
                  </a>
                </li>
                <li class="yui3-menuitem topico">
                  <a class="yui3-menuitem-content" href="https://twitter.com/cge_sp" target="_blank">
                    <i class="fab fa-twitter-square" style="font-size: 21px; color: white"></i>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="yui3-g">
        <style>
          #lista figure {
            height: 1rem;
            width: 1rem;
            display: inline-block;
            margin-top: 0;
            margin-bottom: 0;
          }
          #lista li {
            padding: 0.6rem 0;
            font-size: 1rem;
          }
          #lista a {
            text-decoration: underline;
          }
          #lista a:hover {
            background-color: #e5f9ff;
          }
          #lista #msg-erro {
            color: red;
            font-family: 'Courier New', Courier, monospace;
          }
          .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem;
          }
        </style>
        <div class="titulo-bd py-4">
          Planilhas de Precipitação
          <hr />
        </div>
        <div class="yui3-u">
          <script>
            window.addEventListener('DOMContentLoaded', async () => {
              try {
                const WHICH_SERVER = (() => {
                  if (window.location.href.search('127.0.0.1') > 0) return 'DEV';
                  if (window.location.href.search('localhost') > 0) return 'DEV';
                  if (window.location.href.search('netlify') > 0) return 'HOMOLOG';
                  if (window.location.href.search('github') > 0) return 'HOMOLOG';
                  if (window.location.href.search('saisp.br') > 0) return 'PROD';
                  return '';
                })();
                function githubAssetsUrl() {
                  switch (WHICH_SERVER) {
                    case 'DEV':
                      return 'github-api/assets.json';
                    case 'HOMOLOG':
                      return 'https://api.github.com/repos/lekoshimura/cgesp-relats-chuva/contents/assets';
                    case 'PROD':
                      return 'https://api.github.com/repos/lekoshimura/cgesp-relats-chuva/contents/assets';
                    default:
                      return '';
                  }
                }
                function githubAssetsByYearUrl(year) {
                  switch (WHICH_SERVER) {
                    case 'DEV':
                      return `github-api/assets-${year}.json`;
                    case 'HOMOLOG':
                      return `https://api.github.com/repos/lekoshimura/cgesp-relats-chuva/contents/assets/${year}`;
                    case 'PROD':
                      return `https://api.github.com/repos/lekoshimura/cgesp-relats-chuva/contents/assets/${year}`;
                    default:
                      return '';
                  }
                }
                async function fetchDirs() {
                  try {
                    const response = await fetch(githubAssetsUrl());
                    if (!response.ok) throw response.statusText;
                    const json = await response.json();
                    const dirs = json.sort((a, b) => {
                      // ordena do mais recente para o mais antigo
                      if (a['path'] > b['path']) return -1;
                      if (a['path'] < b['path']) return 1;
                      return 0;
                    });
                    return [dirs, null];
                  } catch (error) {
                    return [null, `${error} at fetchDirs(${githubAssetsUrl()})`];
                  }
                }
                async function fetchDirContent(year) {
                  try {
                    const response = await fetch(githubAssetsByYearUrl(year));
                    if (!response.ok) throw response.statusText;
                    const json = await response.json();
                    return [json, null];
                  } catch (error) {
                    return [null, `${error} at fetchDirContent(${githubAssetsByYearUrl(year)})`];
                  }
                }
                function removeCarregandoContainer() {
                  const msgCarregando = document.getElementById('msg-carregando');
                  msgCarregando.remove();
                }
                function removeMsgErroContainer() {
                  const msgErro = document.getElementById('msg-erro');
                  msgErro.remove();
                }
                function handleError(error) {
                  removeCarregandoContainer();
                  console.error(error);
                  const msgErro = document.getElementById('msg-erro');
                  const h1 = document.createElement('h1');
                  h1.textContent = 'ERRO!';
                  msgErro.appendChild(h1);
                  const pre = document.createElement('pre');
                  pre.textContent = error;
                  msgErro.appendChild(pre);
                }
                const [dirs, errorFetchDirs] = await fetchDirs();
                if (errorFetchDirs) throw errorFetchDirs;
                const listacontainer = document.getElementById('lista');
                for (let i = 0; i < dirs.length; i++) {
                  const h1 = document.createElement('h1');
                  h1.textContent = dirs[i]['name'];
                  const ul = document.createElement('ul');
                  const [dirContent, errorFetchDirContent] = await fetchDirContent(dirs[i]['name']);
                  if (errorFetchDirContent) throw errorFetchDirContent;
                  dirContent.forEach((item) => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.setAttribute('href', item['download_url']);
                    a.setAttribute('download', '');
                    const span = document.createElement('span');
                    span.textContent = item['name'];
                    const figure = document.createElement('figure');
                    figure.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
                              <title>Download</title>
                              <path
                                d="M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40"
                                fill="none"
                                stroke="currentColor"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="32"
                              />
                              <path
                                fill="none"
                                stroke="currentColor"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="32"
                                d="M176 272l80 80 80-80M256 48v288"
                              />
                            </svg>`;
                    a.appendChild(span);
                    a.appendChild(figure);
                    li.appendChild(a);
                    ul.appendChild(li);
                  });
                  listacontainer.appendChild(h1);
                  listacontainer.appendChild(ul);
                }
                removeCarregandoContainer();
                removeMsgErroContainer();
              } catch (error) {
                handleError(error);
              }
            });
          </script>
          <div id="lista" class="content">
            <p id="msg-carregando">Carregando.</p>
            <p id="msg-erro"></p>
          </div>
        </div>
      </div>
    </div>
    <div id="ft">
      <div id="max-width-ft">
        <div class="yui3-g">
          <div class="yui3-u-1-4">
            <ul>
              <li class="tit">Alagamentos</li>
              <li>
                <a href="alagamentos.jsp">Histórico</a>
              </li>
            </ul>
            <ul>
              <li></li>
              <li class="tit">
                <a href="dicas.jsp">Dicas</a>
              </li>
              <li class="tit">
                <a href="sala-de-imprensa.jsp">Sala de Imprensa</a>
              </li>
            </ul>
          </div>
          <div class="yui3-u-1-4">
            <ul>
              <li class="tit">Tempo</li>
              <li>
                <a href="estacoes-meteorologicas.jsp">Estações Meteorológicas</a>
              </li>
              <li>
                <a href="satelite.jsp">Imagem de Satélite</a>
              </li>
              <li>
                <a href="previsao_estendida.jsp">Previsão Estendida</a>
              </li>
            </ul>
          </div>
          <div class="yui3-u-1-4">
            <ul>
              <li class="tit">O CGE</li>
              <li><a href="quem-somos.jsp">Quem Somos</a></li>
              <li><a href="monitoramento.jsp">Monitoramento</a></li>
              <li><a href="operacao-chuvas-de-verao.jsp">Operação Verão</a></li>
              <li><a href="umidade-relativa-do-ar.jsp">Umidade do Ar</a></li>
              <li><a href="baixas-temperaturas.jsp">Baixas Temperaturas</a></li>
              <li><a href="fontes-de-informacao.jsp">Fontes de Informação</a></li>
            </ul>
          </div>
          <div class="yui3-u-1-4">
            <ul>
              <li class="tit">
                <a href="contato.jsp">Contato</a>
              </li>
              <li></li>
              <li>
                <a href="feed_rss.jsp" target="_blank"
                  ><i class="fas fa-rss-square" style="font-size: 21px; color: white"></i
                ></a>
                <a href="https://www.facebook.com/pages/CGE/189602861065357" target="_blank"
                  ><i class="fab fa-facebook-square" style="font-size: 21px; color: white"></i
                ></a>
                <a href="https://twitter.com/cge_sp" target="_blank"
                  ><i class="fab fa-twitter-square" style="font-size: 21px; color: white"></i
                ></a>
              </li>
              <li></li>
              <li class="fone">24hrs - (11) 3396-6739</li>
              <li></li>
              <li>
                <a href="https://www.fcth.br" target="_blank"><img src="images/lay/logo_fcth.png" /></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <script src="https://www.google-analytics.com/urchin.js" type="text/javascript"></script>
      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-16238277-3']);
        _gaq.push(['_trackPageview']);

        (function () {
          var ga = document.createElement('script');
          ga.type = 'text/javascript';
          ga.async = true;
          ga.src =
            ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
        })();
      </script>
    </div>
  </body>
</html>
